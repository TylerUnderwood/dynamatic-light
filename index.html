<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./styles/index.css"  rel="stylesheet">
    <title>Dynamatic Light</title>
</head>
<body>
    <nav id="top-navbar" class="Row pad">
        <a id="logo" class="Logo large" href="/">LOGO</a>
        <div class="filler"></div>
        <ul class="Nav Matrix Gap">
            <li class="Nav__item Cell">
                <a class="Link Meta small" href="./pages/about">About</a>
            </li>
            <li class="Nav__item Cell">
                <a class="Link Meta small" href="./pages/contact">Contact</a>
            </li>
            <li class="Nav__item Cell">
                <a class="Link Meta small" href="./pages/other">Other</a>
            </li>
        </ul>
    </nav>
    <main>
        <header id="banner" class="Banner py-section gutter bg-contrast">
            <div class="wrapper">
                <h1 class="Title">Title of the page</h1>
            </div>
        </header>
        <section id="section-one" class="Section my-section gutter">
            <div class="wrapper">
                <h2>Section One</h2>
            </div>
        </section>
        <section id="section-two" class="Section my-section gutter">
            <div class="wrapper">
                <h2>Modal</h2>
                <button
                    class="Button"
                    modal-trigger="demoModal"
                    style="margin-top: 1rem;"
                >
                    Open Modal
                </button>

                <dialog id="demoModal" class="Modal" modal data-duration="300">
                    <button class="Modal__backdrop" modal-trigger="demoModal"></button>
                    <div class="Modal__container">
                        <button class="Modal__close" modal-trigger="demoModal"></button>
                        <div class="Card" style="max-width: 320px">
                            <h3>Hello World</h3>
                            <p style="margin-bottom: 0;">Lorem ipsum dolor sit, amet consectetur adipisicing elit. Molestias harum ipsum cupiditate, soluta similique cumque. Dignissimos aspernatur ut, nam aperiam consequuntur tempora eligendi praesentium expedita alias ratione voluptatem quae vel.</p>
                        </div>
                    </div>
                </dialog>
            </div>
        </section>
    </main>
    <nav id="bottom-navbar" class="pad">

    </nav>
    <script>
 //////////////////////////////
// Modal

// const modal = ( modalElement ) => {
//   const id = modalElement.id;
//   const modal = document.getElementById(elementId);

// }

// function isActive( element ) {
//   return element.dataset.state === 'active';
// }

class Modal
{
    constructor( elementId ) {
        this.id = elementId;
        this.modal = document.getElementById(elementId);
        this.buttons = document.querySelectorAll(`[modal-trigger="${elementId}"]`);
        this.duration = this.modal.dataset.duration ? this.modal.dataset.duration : 300;
        this.init();
    }

    escClose( event ) {
        let isKeyPressed = ( event.key === 'Escape' || event.keyCode === '27' );

        if ( !this.isActive() || !isKeyPressed ) { return };

        event.preventDefault();
        this.open();
    }

    isActive() {
        return this.modal.dataset.state === 'active';
    }

    isAnimating() {
        return this.modal.dataset.state === 'enter' || this.modal.dataset.state === 'leave';
    }

    setStateAttribute( state ) {
        this.modal.dataset.state = state;
        this.buttons.forEach( (button) => {
            button.dataset.state = state;
        })
    }

    setModalActive() {
        document.documentElement.style.overflow = 'hidden';
        document.body.classList.add(this.id + '--active');
    }

    setModalInactive() {
        document.documentElement.style.overflow = null;
        document.body.classList.remove(this.id + '--active');
    }

    close() {
        this.modal.showModal();
        this.setStateAttribute('enter');
        this.setModalActive();

        setTimeout( () => {
            this.setStateAttribute('active');
        }, this.duration);
    }

    open() {
        this.setStateAttribute('leave');

        setTimeout( () => {
            this.setStateAttribute('idle');
            this.setModalInactive();
            this.modal.close();
        }, this.duration);
    }

    toggle() {
        if ( this.isAnimating() ) return;
        !this.isActive() ? this.close() : this.open();
    }

    init() {
        this.setStateAttribute('idle');

        document.addEventListener('keydown', ( event ) => {
            this.escClose(event)
        });

        this.buttons.forEach((button) => {
            button.addEventListener('click', ( event ) => {
                event.preventDefault();
                this.toggle();
            });
        });
    }
}

document.querySelectorAll('[modal]').forEach( element => {
    if ( !element.id ) {
        console.log("Modal element needs ID to reference");
    } else {
        new Modal( element.id );
    }
});
    </script>
</body>
</html>
